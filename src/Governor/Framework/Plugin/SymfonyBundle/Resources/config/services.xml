<?xml version="1.0" ?>

<container xmlns="http://symfony.com/schema/dic/services"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">
    <parameters>
        <parameter key="governor.command_gateway.class">Governor\Framework\CommandHandling\Gateway\DefaultCommandGateway</parameter>
        <parameter key="governor.command_bus.class">Governor\Framework\CommandHandling\SimpleCommandBus</parameter>
        <parameter key="governor.event_bus.class">Governor\Framework\EventHandling\SimpleEventBus</parameter>          
        <parameter key="governor.repository.doctrine.class">Governor\Framework\Repository\GenericDoctrineRepository</parameter>
        <parameter key="governor.repository.hybrid.class">Governor\Framework\EventSourcing\HybridDoctrineRepository</parameter>
        <parameter key="governor.repository.eventsourcing.class">Governor\Framework\EventSourcing\EventSourcingRepository</parameter>
        
        <!-- revision resolver classes -->
        <parameter key="governor.revision_resolver.class">Governor\Framework\Serializer\NullRevisionResolver</parameter>
        
        <!-- serializer classes -->
        <parameter key="governor.serializer.jms.class">Governor\Framework\Serializer\JMSSerializer</parameter>
        
        <!-- lock manager classes -->
        <parameter key="governor.lock_manager.null.class">Governor\Framework\Repository\NullLockManager</parameter>
        
        <!-- command target resolver classes -->
        <parameter key="governor.command_target_resolver.annotation.class">Governor\Framework\CommandHandling\AnnotationCommandTargetResolver</parameter>
        <parameter key="governor.command_target_resolver.metadata.class">Governor\Framework\CommandHandling\MetadataCommandTargetResolver</parameter>
        
        <!-- aggregate factory -->
        <parameter key="governor.aggregate_factory.generic.class">Governor\Framework\EventSourcing\GenericAggregateFactory</parameter>
        
        <!-- event store classes -->
        <parameter key="governor.event_store.null.class">Governor\Framework\EventStore\NullEventStore</parameter>
        <parameter key="governor.event_store.orm.class">Governor\Framework\EventStore\Orm\OrmEventStore</parameter>
        <parameter key="governor.event_store.odm.class">Governor\Framework\EventStore\Odm\OdmEventStore</parameter>
        <parameter key="governor.event_store.filesystem.class">Governor\Framework\EventStore\Filesystem\FilesystemEventStore</parameter>
        
        <parameter key="governor.event_file_resolver.class">Governor\Framework\EventStore\Filesystem\SimpleEventFileResolver</parameter>
    </parameters>

    <services>        
        
        <!-- revision resolver -->
        <service id="governor.revision_resolver" class="%governor.revision_resolver.class%">
        </service>
        
        <!-- lock managers -->
        <service id="governor.lock_manager.null" class="%governor.lock_manager.null.class%">
        </service>
        
        <!-- command target resolvers -->
        
        <service id="governor.command_target_resolver.annotation" class="%governor.command_target_resolver.annotation.class%"/>
        <service id="governor.command_target_resolver.metadata" class="%governor.command_target_resolver.metadata.class%"/>
        
        
        <!-- aggregate factory -->
        <service id="governor.aggregate_factory" class="%governor.aggregate_factory.generic.class%">
        </service>
        
        <service id="governor.command_gateway" class="%governor.command_gateway.class%">
            <argument type="service" id="governor.command_bus" />
        </service>
        
        <service id="governor.command_bus" class="%governor.command_bus.class%"/>                    
        <service id="governor.event_bus" class="%governor.event_bus.class%"/>
                      
        <service id="governor.serializer.jms" class="%governor.serializer.jms.class%">
            <argument type="service" id="governor.revision_resolver"/>
        </service>
              
        <service id="governor.repository.doctrine" class="%governor.repository.doctrine.class%" abstract="true" public="false">
            <argument strict="false"></argument>    
            <argument type="service" id="governor.event_bus"/>        
            <argument type="service" id="governor.lock_manager"/>
            <argument type="service" id="doctrine.orm.default_entity_manager"/>
        </service>
        
        <service id="governor.repository.hybrid" class="%governor.repository.hybrid.class%" abstract="true" public="false">
            <argument strict="false"></argument>    
            <argument type="service" id="governor.event_bus"/>        
            <argument type="service" id="governor.lock_manager"/>
            <argument type="service" id="doctrine.orm.default_entity_manager"/>
            <argument type="service" id="governor.event_store"/>
        </service>
        
        <service id="governor.repository.eventsourcing" class="%governor.repository.eventsourcing.class%" abstract="true" public="false">
            <argument strict="false"></argument>    
            <argument type="service" id="governor.event_bus"/>        
            <argument type="service" id="governor.lock_manager"/>
            <argument type="service" id="governor.event_store"/>
            <argument type="service" id="governor.aggregate_factory"/>
        </service>
    </services>
</container>

